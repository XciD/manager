<div class="servingAddModel">
    <h1 data-translate="pci_projects_project_serving_namespace_models_add"></h1>

    <oui-stepper data-on-finish="$ctrl.addModel()">

        <oui-step-form
            data-header="{{ :: 'pci_projects_project_serving_namespace_models_add_type' | translate }}"
            data-editable="!$ctrl.isAdding"
            data-loading="$ctrl.isAdding">
            <oui-radio
                data-ng-repeat="workflowTemplate in $ctrl.workflowTemplates track by $index"
                data-model="$ctrl.model.workflowTemplate"
                data-name="workflowTemplate"
                data-value="workflowTemplate"
                data-required>
                <span
                    data-translate="{{:: 'pci_projects_project_serving_namespace_models_add_type_' + workflowTemplate.toLowerCase() }}"></span>
                <button
                    type="button"
                    class="oui-popover-button"
                    data-oui-popover="{{:: 'pci_projects_project_serving_namespace_models_add_type_' + workflowTemplate.toLowerCase() + '_popover' | translate }}"
                    data-oui-popover-placement="auto"></button>
            </oui-radio>
        </oui-step-form>

        <oui-step-form
            data-header="{{ :: 'pci_projects_project_serving_namespace_models_add_model' | translate }}"
            data-editable="!$ctrl.isAdding"
            data-valid="$ctrl.model.workflowTemplate == $ctrl.PRESET_IMAGE || $ctrl.model.storagePath"
            data-loading="$ctrl.isAdding">
            <div class="container-fluid px-0" data-ng-if="$ctrl.model.workflowTemplate == $ctrl.PRESET_IMAGE">
                <div class="row">
                    <div class="col-md-6 col-xl-4 my-3"
                         data-ng-repeat="preset in $ctrl.presetImages track by preset.id">
                        <oui-select-picker
                            data-name="{{:: preset.id }}"
                            data-description="{{:: preset.description }}"
                            data-model="$ctrl.model.imageId"
                            data-label="{{:: preset.name }}"
                            data-variant="light"
                            data-values="[preset]"
                            data-required>

                            <span class="oui-select-picker__section">
                                <a target="_blank" class="oui-button oui-button_link" rel="noopener"
                                   data-ng-href="{{:: preset.link }}">
                                    <span>{{ :: 'pci_projects_project_serving_namespace_models_add_model_preset_info' | translate }}</span>
                                </a>
                            </span>

                        </oui-select-picker>
                    </div>
                </div>
            </div>

            <div data-ng-if="$ctrl.model.workflowTemplate == $ctrl.BUILD_IMAGE">
                <div data-ng-if="$ctrl.paths.length">
                    <span data-translate="pci_projects_project_serving_namespace_models_add_storage_path_info"></span>

                    <oui-field data-size="xl" data-ng-if="$ctrl.paths.length">
                        <oui-select
                            disabled="$ctrl.paths.length == 0"
                            id="storagePath"
                            name="storagePath"
                            model="$ctrl.model.storagePath"
                            items="$ctrl.paths"
                            data-required>
                        </oui-select>
                    </oui-field>
                </div>
                <button class="oui-button oui-button_link" ng-click="$ctrl.goToContainer()" data-ng-if="!$ctrl.paths.length">
                    <span class="text-danger"
                          data-translate="pci_projects_project_serving_namespace_models_add_storage_path_no_path"></span>
                </button>
            </div>
        </oui-step-form>

        <oui-step-form
            data-header="{{ :: 'pci_projects_project_serving_namespace_models_add_name' | translate }}"
            data-editable="!$ctrl.isAdding"
            data-loading="$ctrl.isAdding">

            <oui-field  data-size="xl"
                        data-help-text="{{ :: 'pci_projects_project_serving_namespace_models_add_name_help' | translate }}">
                <input class="oui-input" type="text"
                       id="name" name="id"
                       data-ng-model="$ctrl.model.id"
                       data-required
                       data-ng-pattern="/^[\w-]+$/"/>
            </oui-field>
        </oui-step-form>

        <oui-step-form
            data-header="{{ :: 'pci_projects_project_serving_namespace_models_add_autoscaling' | translate }}"
            data-editable="!$ctrl.isAdding"
            data-loading="$ctrl.isAdding">

            <span data-translate="pci_projects_project_serving_namespace_models_add_autoscaling_info"></span>

            <oui-field data-label="{{:: 'pci_projects_project_serving_namespace_models_storage_scale_min' | translate }}"
                       data-size="auto">
                <oui-numeric min="1" max="1" data-model="$ctrl.scale_min" name="scale_min" disabled>
                </oui-numeric>
            </oui-field>
            <oui-field data-label="{{:: 'pci_projects_project_serving_namespace_models_storage_scale_max' | translate }}"
                       data-size="auto">
                <oui-numeric min="3" max="3" data-model="$ctrl.scale_max" name="scale_max" disabled>
                </oui-numeric>
            </oui-field>
        </oui-step-form>

        <oui-step-form
            data-header="{{ :: 'pci_projects_project_serving_namespace_models_add_instances' | translate }}"
            data-submit-text="{{ :: 'pci_projects_project_serving_namespace_models_common_add' | translate }}"
            data-editable="!$ctrl.isAdding"
            data-loading="$ctrl.isAdding">

            <span data-translate="pci_projects_project_serving_namespace_models_add_instances_info"></span>

            <div class="container-fluid px-0">
                <div class="row">
                    <div class="col-md-6 col-xl-4 my-3"
                         data-ng-repeat="flavor in $ctrl.flavors track by flavor.id">
                        <oui-select-picker
                            data-name="{{:: flavor.id }}"
                            data-model="$ctrl.model.flavor"
                            data-label="{{:: flavor.description }}"
                            data-variant="light"
                            data-values="[flavor]"
                            data-required>
                        </oui-select-picker>
                    </div>
                </div>
            </div>
        </oui-step-form>
    </oui-stepper>
</div>

