<cui-message-container data-messages="$ctrl.messages"></cui-message-container>

<div ui-view>
    <div class="row d-lg-flex">
        <div class="col-md-4">
            <oui-tile
                data-heading="{{ ::'pci_projects_project_training_dashboard_information' | translate }}"
            >
                <div class="oui-tile__item">
                    <dl class="oui-tile__definition">
                        <dt class="oui-tile__term">
                            <span
                                data-translate="pci_projects_project_training_dashboard_console_url"
                            ></span>
                            <button
                                type="button"
                                class="oui-popover-button"
                                data-oui-popover="{{:: 'pci_projects_project_training_dashboard_console_url_help' | translate}}"
                            ></button>
                        </dt>

                        <oui-tile-description>
                            <a
                                class="oui-link oui-link_icon"
                                href="{{ :: $ctrl.eaiConsoleUrl }}"
                                target="_blank"
                                rel="noopener"
                                >{{ :: $ctrl.eaiConsoleUrl }}<span
                                    class="oui-icon oui-icon-external_link"
                                    aria-hidden="true"
                                ></span
                            ></a>
                        </oui-tile-description>
                    </dl>
                </div>
                <div
                    class="oui-tile__item"
                    data-ng-if="$ctrl.trainingFeatures.registry"
                >
                    <dl class="oui-tile__definition">
                        <dt class="oui-tile__term">
                            <span
                                data-translate="pci_projects_project_training_dashboard_registry"
                            ></span>
                            <button
                                type="button"
                                class="oui-popover-button"
                                data-oui-popover="{{:: 'pci_projects_project_training_dashboard_registry_help' | translate }}"
                            ></button>
                        </dt>
                        <oui-tile-description
                            data-ng-if="$ctrl.registry.custom"
                        >
                            <span class="oui-status oui-status_success">
                                <span>{{:: $ctrl.registry.url }}</span>
                            </span>
                        </oui-tile-description>
                        <oui-tile-description
                            data-ng-if="!$ctrl.registry.custom"
                        >
                            <span class="oui-status oui-status_info">
                                <span
                                    >{{::
                                    'pci_projects_project_training_dashboard_registry_shared'
                                    | translate }}</span
                                >
                            </span>
                        </oui-tile-description>
                    </dl>
                    <oui-tile-actions>
                        <oui-dropdown placement="end">
                            <oui-dropdown-trigger
                                text="{{ ::'pci_projects_project_training_dashboard_registry_update' | translate }}"
                            ></oui-dropdown-trigger>
                            <oui-dropdown-content>
                                <oui-dropdown-item
                                    data-ng-if="$ctrl.registry.custom"
                                    data-ng-click="$ctrl.goToRegistryDetachTracking()"
                                    >{{
                                    ::'pci_projects_project_training_dashboard_registry_detach'
                                    | translate }}</oui-dropdown-item
                                >
                                <oui-dropdown-item
                                    data-ng-if="!$ctrl.registry.custom"
                                    data-ng-click="$ctrl.goToRegistryAttachTracking()"
                                    >{{
                                    ::'pci_projects_project_training_dashboard_registry_attach'
                                    | translate }}</oui-dropdown-item
                                >
                            </oui-dropdown-content>
                        </oui-dropdown>
                    </oui-tile-actions>
                </div>

                <div class="oui-tile__item">
                    <dl class="oui-tile__definition">
                        <dt class="oui-tile__term">
                            <span
                                data-translate="pci_projects_project_training_dashboard_cli_integration_title"
                            ></span>
                            <button
                                type="button"
                                class="oui-popover-button"
                                data-oui-popover="{{:: 'pci_projects_project_training_dashboard_cli_integration_help' | translate }}"
                            ></button>
                        </dt>
                        <oui-tile-description>
                            {{::
                            'pci_projects_project_training_dashboard_cli_integration_description'
                            | translate }}
                        </oui-tile-description>
                    </dl>
                    <oui-tile-actions>
                        <oui-dropdown placement="end">
                            <oui-dropdown-trigger
                                text="{{ ::'pci_projects_project_training_dashboard_cli_integration_details' | translate }}"
                            ></oui-dropdown-trigger>
                            <oui-dropdown-content>
                                <a
                                    href="{{ :: $ctrl.eaiDocsUrl }}"
                                    target="_blank"
                                    rel="noopener"
                                    class="oui-dropdown-option ng-scope"
                                >
                                    {{
                                    ::'pci_projects_project_training_dashboard_cli_integration_doc'
                                    | translate }}
                                    <span
                                        class="oui-icon oui-icon-external_link"
                                        aria-hidden="true"
                                    ></span>
                                </a>
                                <oui-dropdown-item
                                    href="{{ :: $ctrl.installLink }}"
                                    >{{
                                    ::'pci_projects_project_training_dashboard_cli_integration_install'
                                    | translate }}</oui-dropdown-item
                                >
                            </oui-dropdown-content>
                        </oui-dropdown>
                    </oui-tile-actions>
                </div>
            </oui-tile>
        </div>
        <div class="col-md-4">
            <oui-tile data-heading="Usage">
                <oui-tile-definition>
                    <oui-tile-description>
                        <div class="row d-lg-flex">
                            <div class="col-md-6">
                                <span class="oui-status oui-status_info">
                                    <span
                                        >{{ ::
                                        'pci_projects_project_training_jobs_state_RUNNING'
                                        | translate }}</span
                                    >
                                </span>
                                <h2>{{ :: $ctrl.nbRunning }}</h2>
                            </div>
                            <div class="col-md-6">
                                <span class="oui-status oui-status_success">
                                    <span
                                        >{{ ::
                                        'pci_projects_project_training_jobs_state_SUCCEEDED'
                                        | translate }}</span
                                    >
                                </span>
                                <h2>{{ :: $ctrl.nbSuccess }}</h2>
                            </div>
                        </div>
                    </oui-tile-description>
                </oui-tile-definition>
                <oui-tile-definition>
                    <oui-tile-description>
                        <div class="row d-lg-flex">
                            <div class="col-md-6">
                                <span class="oui-status oui-status_error">
                                    <span
                                        >{{ ::
                                        'pci_projects_project_training_jobs_state_FAILED'
                                        | translate }}</span
                                    >
                                </span>
                                <h2>{{ :: $ctrl.nbFailed }}</h2>
                            </div>
                            <div class="col-md-6">
                                <span class="oui-status oui-status_warning">
                                    <span
                                        >{{ ::
                                        'pci_projects_project_training_jobs_state_OTHER'
                                        | translate }}</span
                                    >
                                </span>
                                <h2>{{ :: $ctrl.nbOther }}</h2>
                            </div>
                        </div>
                    </oui-tile-description>
                </oui-tile-definition>
            </oui-tile>
        </div>
        <div class="col-md-4">
            <oui-tile
                data-heading="{{ :: 'pci_projects_project_training_dashboard_billing_title' | translate }}"
            >
                <div>
                    {{:: $ctrl.resourceUsage }} {{:: $ctrl.currencySymbol }}
                    <span
                        data-translate="pci_projects_project_training_dashboard_billing_month"
                    >
                    </span>
                </div>
                <div>
                    <a href="{{ :: $ctrl.billingLink }}"
                        >{{ ::
                        'pci_projects_project_training_dashboard_billing_link' |
                        translate }}</a
                    >
                </div>
            </oui-tile>
        </div>
    </div>
    <p></p>
    <h4>Tâches actives</h4>
    <oui-datagrid
        id="publicCloudTrainingJobsDatagrid"
        data-rows="$ctrl.runningJobs"
        data-row-loader="$row"
    >
        <oui-datagrid-column
            data-title=":: 'pci_projects_project_training_jobs_id' | translate"
            data-property="id"
            data-type="string"
            data-searchable
            data-filterable
            data-sortable
        >
            <a ng-click="$ctrl.jobInfo($value)" data-ng-bind="$value"></a>
        </oui-datagrid-column>
        <oui-datagrid-column
            data-title=":: 'pci_projects_project_training_jobs_region' | translate"
            data-property="region"
            data-type="string"
            data-searchable
            data-filterable
            data-sortable
        >
            <span data-ng-bind="$value"></span>
        </oui-datagrid-column>
        <oui-datagrid-column
            data-title=":: 'pci_projects_project_training_jobs_image' | translate"
            data-property="image"
            data-type="string"
            data-searchable
            data-filterable
            data-sortable
        >
            <span data-ng-bind="$value"></span>
        </oui-datagrid-column>
        <oui-datagrid-column
            data-title=":: 'pci_projects_project_training_jobs_creator' | translate"
            data-property="user"
            data-type="string"
            data-searchable
            data-filterable
            data-sortable
        >
            <span data-ng-bind="$value"></span>
        </oui-datagrid-column>
        <oui-datagrid-column
            data-title=":: 'pci_projects_project_training_jobs_state' | translate"
            data-property="state"
            data-type="string"
            data-searchable
            data-filterable
            data-sortable
        >
            <span class="oui-status" data-ng-class="$row.getClassForState()">
                <span
                    data-translate="{{:: 'pci_projects_project_training_jobs_state_' + $value }}"
                ></span>
            </span>
        </oui-datagrid-column>
        <oui-datagrid-column
            data-title=":: 'pci_projects_project_training_jobs_created' | translate"
            data-property="created"
            data-type="date"
            data-searchable
            data-filterable
            data-sortable
        >
            <span data-ng-bind="$value | date:'medium'"></span>
        </oui-datagrid-column>
        <oui-action-menu data-align="end" data-compact>
            <oui-action-menu-item data-on-click="$ctrl.jobInfo($row.id)">
                <span
                    data-translate="pci_projects_project_training_jobs_info"
                ></span>
            </oui-action-menu-item>
            <oui-action-menu-item
                data-on-click="$ctrl.jobKill($row.id)"
                data-disabled="!$row.jobCanBeKilled()"
            >
                <span
                    data-translate="pci_projects_project_training_jobs_kill"
                ></span>
            </oui-action-menu-item>
        </oui-action-menu>
        <oui-datagrid-topbar>
            <button
                data-ng-click="$ctrl.goToJobSubmitTracking()"
                data-title="{{:: 'pci_projects_project_training_jobs_list_submit' | translate  }}"
                class="oui-button oui-button_secondary oui-button_icon-left"
            >
                <span
                    class="oui-icon oui-icon-add pr-1"
                    aria-hidden="true"
                ></span>
                <span
                    data-translate="{{:: 'pci_projects_project_training_jobs_list_submit' | translate  }}"
                ></span>
            </button>
            <button
                class="float-right oui-button oui-button_secondary oui-button_icon-only oui-button_s"
                data-title="{{:: 'pci_projects_project_training_data_refresh' | translate }}"
                data-ng-click="$ctrl.refreshState()"
            >
                <span class="fa fa-refresh" aria-hidden="true"></span>
            </button>
        </oui-datagrid-topbar>
    </oui-datagrid>
</div>
